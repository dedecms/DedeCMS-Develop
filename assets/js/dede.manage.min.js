$(document).ready(function () {
// 关闭菜单
$(document).click(function (event) {
window.parent.UIkit.dropdown("#allmenu").hide(0);
window.parent.UIkit.dropdown("#fastmenu").hide(0);
});

// checkbox 全选或选取消
$("#select-all").click(function (event) {
if (this.checked) {
$(":checkbox").prop("checked", true);
} else {
$(":checkbox").prop("checked", false);
}
});

// 树形列表节点展开
$(".dede-show-type").click(function () {
if ($('#type_'+this.id).is('.uk-hidden')){
$(this).attr("data-uk-icon","dash-square");
$('#type_'+this.id).removeClass( "uk-hidden" );
}else{
$(this).attr("data-uk-icon","plus-square");
$('#type_'+this.id).addClass( "uk-hidden" );
}
});

// 缩略图:

// 监听upload元素，当获取到文件后打开操作窗口  
$('#upload-image').on('change', function () {  
if (typeof($uploadCrop) ==="undefined"){
$uploadCrop = $('#image-crop').croppie({
viewport: { width: 188, height: 250 },
boundary: { width: 600, height: 300 },
});
}



UIkit.modal("#modal-upload-image").show();
_DedeCMS_JSCODE_Version_Crop_Read_Image_File(this);
});

// 封面
$('.upload-3-4').on('click', function () {  
$uploadCrop.croppie('setView','188','250');
});

// 4:3
$('.upload-4-3').on('click', function () {  
$uploadCrop.croppie('setView','267','200');
});

// 16:9
$('.upload-16-9').on('click', function () {  
$uploadCrop.croppie('setView','356','200');
});

// 头像
$('.upload-1-1').on('click', function () {  
$uploadCrop.croppie('setView','200','200');
});

// 切图
$('.upload-result').on('click', function (ev) {
$uploadCrop.croppie('result', {
type: 'canvas',
size: 'viewport'
}).then(function (resp) {
$("#no_image").addClass("uk-hidden");
$("#result-image").attr('src', resp);
$("#litpic_b64").attr('value', resp);
$("#upload-image").attr('value', resp);
UIkit.modal("#modal-upload-image").hide();
});
});

// END 缩略图.


});

// 多选通用动作
function DedeCMS_JSCODE_Version_Checked_Action(url = "") {
var _CheckedVals = _DedeCMS_JSCODE_Version_Get_Checkbox_Checked()
if (_CheckedVals == "") {
alert("必须选择一个或多个文档！");
} else {
location = url+_CheckedVals
}
}
// 多选通用动作
function _DedeCMS_JSCODE_Version_Get_Checkbox_Checked() {
return $(".dede-checkbox:checkbox:checked").map(function () {
return this.value;
}).get();
}


// 还原所选项
function DedeCMS_JSCODE_Version_Checked_Archive_Revert(aid = 0) {
_DedeCMS_JSCODE_Version_Checked_CallControlURL(
"archives_do.php?aid=" + aid + "&dopost=return"
);
}


// 倾倒回收站
function DedeCMS_JSCODE_Version_Checked_Archive_EmptyTrash(aid = 0) {
_DedeCMS_JSCODE_Version_Checked_CallControlURL(
"archives_do.php?aid=" + aid + "&dopost=del&recycle=1"
);
}

// 移动
function DedeCMS_JSCODE_Version_Checked_Archive_Move(cid) {
_DedeCMS_JSCODE_Version_Checked_CallControlModal(
"archives_do.php?dopost=moveArchives&channelid=" + cid + "&rnd=" + Math.random()
);
}

// 根据Checkbox选项打开功能弹窗
function _DedeCMS_JSCODE_Version_Checked_CallControlModal(url) {
var qstr = _DedeCMS_JSCODE_Version_GetCheckboxItem();
if (qstr == "") {
alert("必须选择一个或多个文档！");
return;
} else {
$.get(url + "&qstr=" + qstr, function () {
$(".uk-modal-dialog").html("");
})
.done(function (data) {
$(".uk-modal-dialog").html(data);
UIkit.modal("#modal-overflow").show();
})
.fail(function () {
alert("URL错误或丢失网络链接。");
});
}
}

// 根据Checkbox选项打开URL
function _DedeCMS_JSCODE_Version_Checked_CallControlURL(url) {
var qstr = _DedeCMS_JSCODE_Version_GetCheckboxItem();
if (qstr == "") {
alert("必须选择一个或多个文档！");
} else {
location = url + "&qstr=" + qstr;
}
}

//获得选中的内容
function _DedeCMS_JSCODE_Version_GetCheckboxItem() {
var checkedVals = $(".check:checkbox:checked")
.map(function () {
return this.value;
})
.get();
return checkedVals.join(",");
}

// END 文章列表管理函数 .


// 去读缩略图源文件
function _DedeCMS_JSCODE_Version_Crop_Read_Image_File(input) {
if (input.files && input.files[0]) {
var reader = new FileReader();
reader.onload = function (e) {
$uploadCrop.croppie('bind', {
url: e.target.result
}).then(function(){
$("#upload-image").val('');
});
}
reader.readAsDataURL(input.files[0]);
}
}


function _DedeCMS_JSCODE_Version_Open_Windows_Get_Archive_ID(id) {
$('#archives').attr('src', 'content_select_list.php?f='+id);
UIkit.modal("#modal-archives").show();
}