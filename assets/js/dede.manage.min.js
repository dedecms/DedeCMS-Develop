$(document).ready(function () {
// 关闭菜单
$(document).click(function (event) {
window.parent.UIkit.dropdown("#allmenu").hide(0);
window.parent.UIkit.dropdown("#fastmenu").hide(0);
});

// checkbox 全选或选取消
$("#select-all").click(function (event) {
if (this.checked) {
$(":checkbox").prop("checked", true);
} else {
$(":checkbox").prop("checked", false);
}
});

// 树形列表节点展开
$(".dede-show-type").click(function () {
if ($('#type_'+this.id).is('.uk-hidden')){
$(this).attr("data-uk-icon","dash-square");
$('#type_'+this.id).removeClass( "uk-hidden" );
}else{
$(this).attr("data-uk-icon","plus-square");
$('#type_'+this.id).addClass( "uk-hidden" );
}
});

// 缩略图:

// 监听upload元素，当获取到文件后打开操作窗口  
$('#upload-image').on('change', function () {  
if (typeof($uploadCrop) ==="undefined"){
$uploadCrop = $('#image-crop').croppie({
viewport: { width: 188, height: 250 },
boundary: { width: 600, height: 300 },
});
}



UIkit.modal("#modal-upload-image").show();
_DedeCMS_JSCODE_Version_Crop_Read_Image_File(this);
});

// 封面
$('.upload-3-4').on('click', function () {  
$uploadCrop.croppie('setView','188','250');
});

// 4:3
$('.upload-4-3').on('click', function () {  
$uploadCrop.croppie('setView','267','200');
});

// 16:9
$('.upload-16-9').on('click', function () {  
$uploadCrop.croppie('setView','356','200');
});

// 头像
$('.upload-1-1').on('click', function () {  
$uploadCrop.croppie('setView','200','200');
});

// 切图
$('.upload-result').on('click', function (ev) {
$uploadCrop.croppie('result', {
type: 'canvas',
size: 'viewport'
}).then(function (resp) {
$("#no_image").addClass("uk-hidden");
$("#result-image").attr('src', resp);
$("#litpic_b64").attr('value', resp);
$("#upload-image").attr('value', resp);
UIkit.modal("#modal-upload-image").hide();
});
});

// END 缩略图.


});

// 多选通用动作
function DedeCMS_JSCODE_Version_Checked_Action(url = "") {
var _CheckedVals = _DedeCMS_JSCODE_Version_Get_Checkbox_Checked()
if (_CheckedVals == "") {
alert("必须选择一个或多个文档！");
} else {
location = url+_CheckedVals
}
}
// 多选通用动作
function _DedeCMS_JSCODE_Version_Get_Checkbox_Checked() {
return $(".dede-checkbox:checkbox:checked").map(function () {
return this.value;
}).get();
}


// 还原所选项
function DedeCMS_JSCODE_Version_Checked_Archive_Revert(aid = 0) {
_DedeCMS_JSCODE_Version_Checked_CallControlURL(
"archives_do.php?aid=" + aid + "&dopost=return"
);
}


// 倾倒回收站
function DedeCMS_JSCODE_Version_Checked_Archive_EmptyTrash(aid = 0) {
_DedeCMS_JSCODE_Version_Checked_CallControlURL(
"archives_do.php?aid=" + aid + "&dopost=del&recycle=1"
);
}

// 移动
function DedeCMS_JSCODE_Version_Checked_Archive_Move(cid) {
_DedeCMS_JSCODE_Version_Checked_CallControlModal(
"archives_do.php?dopost=moveArchives&channelid=" + cid + "&rnd=" + Math.random()
);
}

// 根据Checkbox选项打开功能弹窗
function _DedeCMS_JSCODE_Version_Checked_CallControlModal(url) {
var qstr = _DedeCMS_JSCODE_Version_GetCheckboxItem();
if (qstr == "") {
alert("必须选择一个或多个文档！");
return;
} else {
$.get(url + "&qstr=" + qstr, function () {
$(".uk-modal-dialog").html("");
})
.done(function (data) {
$(".uk-modal-dialog").html(data);
UIkit.modal("#modal-overflow").show();
})
.fail(function () {
alert("URL错误或丢失网络链接。");
});
}
}

// 根据Checkbox选项打开URL
function _DedeCMS_JSCODE_Version_Checked_CallControlURL(url) {
var qstr = _DedeCMS_JSCODE_Version_GetCheckboxItem();
if (qstr == "") {
alert("必须选择一个或多个文档！");
} else {
location = url + "&qstr=" + qstr;
}
}

//获得选中的内容
function _DedeCMS_JSCODE_Version_GetCheckboxItem() {
var checkedVals = $(".check:checkbox:checked")
.map(function () {
return this.value;
})
.get();
return checkedVals.join(",");
}

// END 文章列表管理函数 .


// 去读缩略图源文件
function _DedeCMS_JSCODE_Version_Crop_Read_Image_File(input) {
if (input.files && input.files[0]) {
var reader = new FileReader();
reader.onload = function (e) {
$uploadCrop.croppie('bind', {
url: e.target.result
}).then(function(){
$("#upload-image").val('');
});
}
reader.readAsDataURL(input.files[0]);
}
}


function _DedeCMS_JSCODE_Version_Open_Windows_Get_Archive_ID(id) {
$('#archives').attr('src', 'content_select_list.php?f='+id);
UIkit.modal("#modal-archives").show();
}

function _DedeCMS_JSCODE_Version_Open_Windows_Get_Album() {
$('#archives').attr('src', 'dialog/select_images.php');
UIkit.modal("#modal-archives").show();
}


// 图集
function _DedeCMS_JSCODE_Version_Edit_Atlas_Temporary_Images(dede) {
$(dede).on('change', function(event) {
var file = event.target.files[0];
var reader = new FileReader();
var _imgName = file.name.substring(file.name.lastIndexOf("\\") + 1);//获取文件名.后缀名
var imgname = _imgName.substring(0, _imgName.lastIndexOf('.'))
reader.fileName = imgname
reader.onload = (function () {
return function (e) {
$(dede).next().attr('src',e.target.result);
$(dede).parent().next().children('input').val(e.target.fileName);
};
})(file);
reader.readAsDataURL(file);
$(dede).off()
});
}

function _DedeCMS_JSCODE_Version_Delete_Atlas_Temporary_Images(dede) {
$(dede).parent().parent().parent().remove();
}


function _DedeCMS_JSCODE_Version_Select_Local_Images() {
$('#Dede_Local_File_Images').on('change', function() {
var files = $(this)[0].files;
for (var i = 0; i < files.length; i++) {
var file = files[i];
var _imgName = file.name.substring(file.name.lastIndexOf("\\") + 1);
var imgname = _imgName.substring(0, _imgName.lastIndexOf('.'))
var extn = file.name.substring(file.name.lastIndexOf('.') + 1).toLowerCase();
if (extn == "gif" || extn == "png" || extn == "jpg" || extn == "jpeg") {
if (typeof(FileReader) != "undefined") {
var reader = new FileReader();
reader.fileName = imgname;
reader.onload = function(e) {

var html = "<li>";
html += "<div class='uk-card uk-card-default'><div  style='background-color:#FFF;' class='uk-card uk-card-default uk-card-header'>";
html += "<span class='uk-sortable-handle uk-margin-small-right uk-text-center' uk-icon='icon: arrows-move'></span>";
html += "<button type='button' onclick='_DedeCMS_JSCODE_Version_Delete_Atlas_Temporary_Images(this)' uk-close></button> </div>";
html += "<div class='uk-card-body' uk-form-custom>";
html += "<input type='file' onclick='_DedeCMS_JSCODE_Version_Edit_Atlas_Temporary_Images(this)' accept='image/*'>";
html += "<img style='width: 250px;height:150px' src='"+e.target.result+"'/>";
html += "</div>";
html += "<div class='uk-card-footer' style='background-color:#FFF;'>";
html += "<input type='text' class='uk-input uk-form-small' value='"+e.target.fileName+"' placeholder='注释'></div></div>";
html += "</li>";
$('#Dede_Atlas_Upload').append(html)
// 设置INPUT
albums.push({
"img" : e.target.result,
"txt" : e.target.fileName
})
$("#albums").val(JSON.stringify(albums));

}
reader.readAsDataURL(file);
$("#Dede_Local_File_Images").off()
}}}});
}