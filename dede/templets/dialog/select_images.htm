<html><head><meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" /><title>图片管理器</title><meta name="copyright" content="2007-2020 DedeCMS, 上海卓卓网络科技有限公司 (DesDev, Inc.)" /><link rel="icon" href="/favicon.ico" /><!-- CSS FILES --><link rel="stylesheet" type="text/css" href="{dede:global.cfg_assets_dir/}/pkg/uikit/css/uikit.min.css" /><link rel="stylesheet" type="text/css" href="{dede:global.cfg_assets_dir/}/css/manage.dede.css"><style type="text/css">form {display: block;margin-top: 0em;margin-block-end: 0em;}.bar-bottom {border-top: 1px solid rgba(255, 255, 255, 0.07);background-color: rgba(33, 34, 36, 0.90);padding: 10px 0;left: 0;right: 0;z-index: 3;bottom: 0;position: fixed;display: flex;justify-content: space-between;z-index: 99;min-width: 1050px;}</style></head><body><div id="Table_Header_202X2W2X1X292F" class="uk-card uk-card-small uk-card-default" uk-sticky="bottom: #offset"><table id="dede-table-toolbar" class="uk-table uk-table-middle uk-table-divider uk-table-striped uk-margin-remove"><thead><tr><td width="4%"><input type="checkbox" id="select-all" class="uk-checkbox" /></td><td>文件名</td><td width="15%" align="center">文件大小</td><td width="30%" align="center">最后修改时间</td></tr></thead></table></div><div id="Table_Body_1X2V2U2V1W272D" class="uk-card uk-card-small uk-card-default" style="top: -51;"><div class="uk-card-body uk-overflow-auto" grid><div class="uk-child-width-1-1"><div class="uk-overflow-auto"><table class="uk-table uk-table-hover uk-table-middle uk-table-divider uk-table-striped uk-margin-remove"><thead><tr><td width="4%"><input type="checkbox" id="select-all" class="uk-checkbox" /></td><td>文件名</td><td width="15%" align="center">文件大小</td><td width="30%" align="center">最后修改时间</td></tr></thead><tbody><!-- 内容列表 --><?php$dh = dir($inpath);$ty1 = "";$ty2 = "";while ($file = $dh->read()) { //-----计算文件大小和创建时间if ($file != "." && $file != ".." && !is_dir("$inpath/$file")) {$filesize = filesize("$inpath/$file");$filesize = $filesize / 1024;if ($filesize != "") {if ($filesize < 0.1) {@list($ty1, $ty2) = preg_split("\.", $filesize);$filesize = $ty1 . "." . substr($ty2, 0, 2);} else {@list($ty1, $ty2) = preg_split("\.", $filesize);$filesize = $ty1 . "." . substr($ty2, 0, 1);}} $filetime = filemtime("$inpath/$file");$filetime = MyDate("Y-m-d H:i:s", $filetime);} if ($file == ".") {continue;} else if ($file == "..") {if ($activepath == "") {continue;} $tmp = preg_replace("#[\/][^\/]*$#i", "", $activepath);$line = "\n<tr><td colspan='2'><a href='select_images.php?imgstick=$imgstick&v=$v&f=$f&activepath=" . urlencode($tmp) . $addparm . "'>上级目录</a></td><td colspan='2'> 当前目录:$activepath</td></tr>";echo $line;} else if (is_dir("$inpath/$file")) {if (preg_match("#^_(.*)$#i", $file)) {continue;}#屏蔽FrontPage扩展目录和linux隐蔽目录if (preg_match("#^\.(.*)$#i", $file)) {continue;} $line = "\n<tr><td colspan='2'><a href='select_images.php?imgstick=$imgstick&v=$v&f=$f&activepath=" . urlencode("$activepath/$file") . $addparm . "'><img src=img/dir.gif border=0 width=16 height=16 align=absmiddle>$file</a></td><td>　</td><td>　</td></tr>";echo "$line";} else if (preg_match("#\.(" . $cfg_imgtype . ")#i", $file)) {$reurl = "$activeurl/$file";$reurl = preg_replace("#^\.\.#", "", $reurl);if ($cfg_remote_site == 'Y' && $remoteuploads == 1) {$reurl = $remoteupUrl . $reurl;} else {$reurl = $reurl;} if ($file == $comeback) {$lstyle = " style='color:red' ";} else {$lstyle = "";} $line = "\n<tr><td align='center'><a href=\"#\" onClick=\"ChangeImage('$reurl');\"><img src='img/eye.png' width='16' height='16' border='0' align=absmiddle></a></td><td><a href=# onclick=\"ReturnImg('$reurl');\" $lstyle><img src=img/gif.gif border=0 width=16 height=16 align=absmiddle>$file</a></td><td>$filesize KB</td><td align='center'>$filetime</td></tr>";echo "$line";} else if (preg_match("#\.(jpg)#i", $file)) {$reurl = "$activeurl/$file";$reurl = preg_replace("#^\.\.#", "", $reurl);if ($cfg_remote_site == 'Y' && $remoteuploads == 1) {$reurl = $remoteupUrl . $reurl;} else {$reurl = $reurl;} if ($file == $comeback) {$lstyle = " style='color:red' ";} else {$lstyle = "";} $line = "\n<tr><td align='center'><a href=\"#\" onClick=\"ChangeImage('$reurl');\"><img src='img/eye.png' width='16' height='16' border='0' align=absmiddle></a></td><td><a href=# onclick=\"ReturnImg('$reurl');\" $lstyle><img src=img/jpg.gif border=0 width=16 height=16 align=absmiddle>$file</a></td><td>$filesize KB</td><td align='center'>$filetime</td></tr>";echo "$line";}} //End Loop$dh->close();?><!-- /内容列表 --></tbody></table></div></div></div></div><div class="bar-bottom uk-flex uk-light uk-flex-right"><div class="e1e02" style="margin-left: 20px;"><button id="submit_id" type="submit" class="uk-button uk-button-default uk-button-small" width="60px">添加所选图片</button></div></div><!-- JS FILES --><script src="{dede:global.cfg_assets_dir/}/pkg/uikit/js/uikit.min.js"></script><script src="{dede:global.cfg_assets_dir/}/pkg/uikit/js/uikit-icons.min.js"></script><script src="{dede:global.cfg_assets_dir/}/pkg/jquery/jquery.min.js"></script><script src="{dede:global.cfg_assets_dir/}/js/dede.manage.min.js"></script><script language="javascript">$(document).ready(function() {$('#submit_id').click(function (event) {var ids = _DedeCMS_JSCODE_Version_Get_Checkbox_Checked()if (ids == "") {alert("必须选择一个或多个文档！");}else{window.parent.$("#{dede:global.f/}").val(ids);window.parent.UIkit.modal("#modal-archives").hide(0);}});});</script></body></html>